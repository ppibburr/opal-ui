/* Generated by Opal 0.6.2 */
(function($opal) {
  var self = $opal.top, $scope = $opal, nil = $opal.nil, $breaker = $opal.breaker, $slice = $opal.slice, $klass = $opal.klass;

  $opal.add_stubs(['$resolve', '$new', '$reject', '$attr_reader', '$!', '$==', '$<<', '$>>', '$exception?', '$resolved?', '$value', '$rejected?', '$===', '$error', '$realized?', '$raise', '$^', '$call', '$resolve!', '$exception!', '$reject!', '$class', '$object_id', '$+', '$inspect', '$act?', '$prev', '$concat', '$it', '$lambda', '$reverse', '$each', '$wait', '$then', '$to_proc', '$map', '$reduce', '$always', '$try', '$tap', '$all?', '$find']);
  return (function($base, $super) {
    function $Promise(){};
    var self = $Promise = $klass($base, $super, 'Promise', $Promise);

    var def = self._proto, $scope = self._scope, TMP_1, TMP_2, TMP_3, TMP_4;

    def.success = def.exception = def.realized = def.delayed = def.failure = def.error = def.prev = def.next = def.value = nil;
    $opal.defs(self, '$value', function(value) {
      var self = this;

      return self.$new().$resolve(value);
    });

    $opal.defs(self, '$error', function(value) {
      var self = this;

      return self.$new().$reject(value);
    });

    $opal.defs(self, '$when', function(promises) {
      var self = this;

      promises = $slice.call(arguments, 0);
      return $scope.When.$new(promises);
    });

    self.$attr_reader("value", "error", "prev", "next");

    def.$initialize = function(success, failure) {
      var self = this;

      if (success == null) {
        success = nil
      }
      if (failure == null) {
        failure = nil
      }
      self.success = success;
      self.failure = failure;
      self.realized = nil;
      self.exception = false;
      self.value = nil;
      self.error = nil;
      self.delayed = nil;
      self.prev = nil;
      return self.next = nil;
    };

    def['$act?'] = function() {
      var self = this;

      return self.success['$=='](nil)['$!']();
    };

    def['$exception?'] = function() {
      var self = this;

      return self.exception;
    };

    def['$realized?'] = function() {
      var self = this;

      return self.realized['$=='](nil)['$!']();
    };

    def['$resolved?'] = function() {
      var self = this;

      return self.realized['$==']("resolve");
    };

    def['$rejected?'] = function() {
      var self = this;

      return self.realized['$==']("reject");
    };

    def['$^'] = function(promise) {
      var self = this;

      promise['$<<'](self);
      self['$>>'](promise);
      return promise;
    };

    def['$<<'] = function(promise) {
      var self = this;

      self.prev = promise;
      return self;
    };

    def['$>>'] = function(promise) {
      var $a, $b, $c, $d, self = this;

      self.next = promise;
      if ((($a = self['$exception?']()) !== nil && (!$a._isBoolean || $a == true))) {
        promise.$reject(self.delayed)
      } else if ((($a = self['$resolved?']()) !== nil && (!$a._isBoolean || $a == true))) {
        promise.$resolve(((($a = self.delayed) !== false && $a !== nil) ? $a : self.$value()))
      } else if ((($a = ($b = self['$rejected?'](), $b !== false && $b !== nil ?(((($c = self.failure['$!']()) !== false && $c !== nil) ? $c : $scope.Promise['$===']((((($d = self.delayed) !== false && $d !== nil) ? $d : self.error))))) : $b)) !== nil && (!$a._isBoolean || $a == true))) {
        promise.$reject(((($a = self.delayed) !== false && $a !== nil) ? $a : self.$error()))};
      return self;
    };

    def.$resolve = function(value) {
      var $a, self = this, e = nil;

      if (value == null) {
        value = nil
      }
      if ((($a = self['$realized?']()) !== nil && (!$a._isBoolean || $a == true))) {
        self.$raise($scope.ArgumentError, "the promise has already been realized")};
      if ((($a = $scope.Promise['$==='](value)) !== nil && (!$a._isBoolean || $a == true))) {
        value['$<<'](self.prev);
        return value['$^'](self);};
      self.realized = "resolve";
      self.value = value;
      try {
      if ((($a = self.success) !== nil && (!$a._isBoolean || $a == true))) {
          value = self.success.$call(value)};
        self['$resolve!'](value);
      } catch ($err) {if ($opal.$rescue($err, [$scope.Exception])) {e = $err;
        self['$exception!'](e)
        }else { throw $err; }
      };
      return self;
    };

    def['$resolve!'] = function(value) {
      var $a, self = this;

      if ((($a = self.next) !== nil && (!$a._isBoolean || $a == true))) {
        return self.next.$resolve(value)
        } else {
        return self.delayed = value
      };
    };

    def.$reject = function(value) {
      var $a, self = this, e = nil;

      if (value == null) {
        value = nil
      }
      if ((($a = self['$realized?']()) !== nil && (!$a._isBoolean || $a == true))) {
        self.$raise($scope.ArgumentError, "the promise has already been realized")};
      if ((($a = $scope.Promise['$==='](value)) !== nil && (!$a._isBoolean || $a == true))) {
        value['$<<'](self.prev);
        return value['$^'](self);};
      self.realized = "reject";
      self.error = value;
      try {
      if ((($a = self.failure) !== nil && (!$a._isBoolean || $a == true))) {
          value = self.failure.$call(value);
          if ((($a = $scope.Promise['$==='](value)) !== nil && (!$a._isBoolean || $a == true))) {
            self['$reject!'](value)};
          } else {
          self['$reject!'](value)
        }
      } catch ($err) {if ($opal.$rescue($err, [$scope.Exception])) {e = $err;
        self['$exception!'](e)
        }else { throw $err; }
      };
      return self;
    };

    def['$reject!'] = function(value) {
      var $a, self = this;

      if ((($a = self.next) !== nil && (!$a._isBoolean || $a == true))) {
        return self.next.$reject(value)
        } else {
        return self.delayed = value
      };
    };

    def['$exception!'] = function(error) {
      var self = this;

      self.exception = true;
      return self['$reject!'](error);
    };

    def.$then = TMP_1 = function() {
      var self = this, $iter = TMP_1._p, block = $iter || nil;

      TMP_1._p = null;
      return self['$^']($scope.Promise.$new(block));
    };

    $opal.defn(self, '$do', def.$then);

    def.$fail = TMP_2 = function() {
      var self = this, $iter = TMP_2._p, block = $iter || nil;

      TMP_2._p = null;
      return self['$^']($scope.Promise.$new(nil, block));
    };

    $opal.defn(self, '$rescue', def.$fail);

    $opal.defn(self, '$catch', def.$fail);

    def.$always = TMP_3 = function() {
      var self = this, $iter = TMP_3._p, block = $iter || nil;

      TMP_3._p = null;
      return self['$^']($scope.Promise.$new(block, block));
    };

    $opal.defn(self, '$finally', def.$always);

    $opal.defn(self, '$ensure', def.$always);

    def.$trace = TMP_4 = function() {
      var self = this, $iter = TMP_4._p, block = $iter || nil;

      TMP_4._p = null;
      return self['$^']($scope.Trace.$new(block));
    };

    def.$inspect = function() {
      var $a, self = this, result = nil;

      result = "#<" + (self.$class()) + "(" + (self.$object_id()) + ")";
      if ((($a = self.next) !== nil && (!$a._isBoolean || $a == true))) {
        result = result['$+'](" >> " + (self.next.$inspect()))};
      if ((($a = self['$realized?']()) !== nil && (!$a._isBoolean || $a == true))) {
        result = result['$+'](": " + ((((($a = self.value) !== false && $a !== nil) ? $a : self.error)).$inspect()) + ">")
        } else {
        result = result['$+'](">")
      };
      return result;
    };

    (function($base, $super) {
      function $Trace(){};
      var self = $Trace = $klass($base, $super, 'Trace', $Trace);

      var def = self._proto, $scope = self._scope, TMP_6;

      $opal.defs(self, '$it', function(promise) {
        var $a, self = this, current = nil, prev = nil;

        if ((($a = promise['$realized?']()) !== nil && (!$a._isBoolean || $a == true))) {
          } else {
          self.$raise($scope.ArgumentError, "the promise hasn't been realized")
        };
        current = (function() {if ((($a = promise['$act?']()) !== nil && (!$a._isBoolean || $a == true))) {
          return [promise.$value()]
          } else {
          return []
        }; return nil; })();
        if ((($a = prev = promise.$prev()) !== nil && (!$a._isBoolean || $a == true))) {
          return current.$concat(self.$it(prev))
          } else {
          return current
        };
      });

      return (def.$initialize = TMP_6 = function(block) {
        var $a, $b, TMP_5, self = this, $iter = TMP_6._p, $yield = $iter || nil;

        TMP_6._p = null;
        return $opal.find_super_dispatcher(self, 'initialize', TMP_6, null).apply(self, [($a = ($b = self).$lambda, $a._p = (TMP_5 = function(){var self = TMP_5._s || this, $a;

        return ($a = block).$call.apply($a, [].concat($scope.Trace.$it(self).$reverse()))}, TMP_5._s = self, TMP_5), $a).call($b)]);
      }, nil) && 'initialize';
    })(self, self);

    return (function($base, $super) {
      function $When(){};
      var self = $When = $klass($base, $super, 'When', $When);

      var def = self._proto, $scope = self._scope, TMP_7, TMP_9, TMP_11, TMP_13, TMP_17;

      def.wait = nil;
      def.$initialize = TMP_7 = function(promises) {
        var $a, $b, TMP_8, self = this, $iter = TMP_7._p, $yield = $iter || nil;

        if (promises == null) {
          promises = []
        }
        TMP_7._p = null;
        $opal.find_super_dispatcher(self, 'initialize', TMP_7, null).apply(self, []);
        self.wait = [];
        return ($a = ($b = promises).$each, $a._p = (TMP_8 = function(promise){var self = TMP_8._s || this;
if (promise == null) promise = nil;
        return self.$wait(promise)}, TMP_8._s = self, TMP_8), $a).call($b);
      };

      def.$each = TMP_9 = function() {
        var $a, $b, TMP_10, self = this, $iter = TMP_9._p, block = $iter || nil;

        TMP_9._p = null;
        if (block !== false && block !== nil) {
          } else {
          self.$raise($scope.ArgumentError, "no block given")
        };
        return ($a = ($b = self).$then, $a._p = (TMP_10 = function(values){var self = TMP_10._s || this, $a, $b;
if (values == null) values = nil;
        return ($a = ($b = values).$each, $a._p = block.$to_proc(), $a).call($b)}, TMP_10._s = self, TMP_10), $a).call($b);
      };

      def.$collect = TMP_11 = function() {
        var $a, $b, TMP_12, self = this, $iter = TMP_11._p, block = $iter || nil;

        TMP_11._p = null;
        if (block !== false && block !== nil) {
          } else {
          self.$raise($scope.ArgumentError, "no block given")
        };
        return ($a = ($b = self).$then, $a._p = (TMP_12 = function(values){var self = TMP_12._s || this, $a, $b;
if (values == null) values = nil;
        return $scope.When.$new(($a = ($b = values).$map, $a._p = block.$to_proc(), $a).call($b))}, TMP_12._s = self, TMP_12), $a).call($b);
      };

      def.$inject = TMP_13 = function(args) {
        var $a, $b, TMP_14, self = this, $iter = TMP_13._p, block = $iter || nil;

        args = $slice.call(arguments, 0);
        TMP_13._p = null;
        return ($a = ($b = self).$then, $a._p = (TMP_14 = function(values){var self = TMP_14._s || this, $a, $b;
if (values == null) values = nil;
        return ($a = ($b = values).$reduce, $a._p = block.$to_proc(), $a).apply($b, [].concat(args))}, TMP_14._s = self, TMP_14), $a).call($b);
      };

      $opal.defn(self, '$map', def.$collect);

      $opal.defn(self, '$reduce', def.$inject);

      def.$wait = function(promise) {
        var $a, $b, TMP_15, self = this;

        if ((($a = $scope.Promise['$==='](promise)) !== nil && (!$a._isBoolean || $a == true))) {
          } else {
          promise = $scope.Promise.$value(promise)
        };
        if ((($a = promise['$act?']()) !== nil && (!$a._isBoolean || $a == true))) {
          promise = promise.$then()};
        self.wait['$<<'](promise);
        ($a = ($b = promise).$always, $a._p = (TMP_15 = function(){var self = TMP_15._s || this, $a;
          if (self.next == null) self.next = nil;

        if ((($a = self.next) !== nil && (!$a._isBoolean || $a == true))) {
            return self.$try()
            } else {
            return nil
          }}, TMP_15._s = self, TMP_15), $a).call($b);
        return self;
      };

      $opal.defn(self, '$and', def.$wait);

      def['$>>'] = TMP_17 = function() {var $zuper = $slice.call(arguments, 0);
        var $a, $b, TMP_16, self = this, $iter = TMP_17._p, $yield = $iter || nil;

        TMP_17._p = null;
        return ($a = ($b = $opal.find_super_dispatcher(self, '>>', TMP_17, $iter).apply(self, $zuper)).$tap, $a._p = (TMP_16 = function(){var self = TMP_16._s || this;

        return self.$try()}, TMP_16._s = self, TMP_16), $a).call($b);
      };

      return (def.$try = function() {
        var $a, $b, $c, $d, self = this, promise = nil;

        if ((($a = ($b = ($c = self.wait)['$all?'], $b._p = "realized?".$to_proc(), $b).call($c)) !== nil && (!$a._isBoolean || $a == true))) {
          if ((($a = promise = ($b = ($d = self.wait).$find, $b._p = "rejected?".$to_proc(), $b).call($d)) !== nil && (!$a._isBoolean || $a == true))) {
            return self.$reject(promise.$error())
            } else {
            return self.$resolve(($a = ($b = self.wait).$map, $a._p = "value".$to_proc(), $a).call($b))
          }
          } else {
          return nil
        };
      }, nil) && 'try';
    })(self, self);
  })(self, null)
})(Opal);
/* Generated by Opal 0.6.2 */
(function($opal) {
  var self = $opal.top, $scope = $opal, nil = $opal.nil, $breaker = $opal.breaker, $slice = $opal.slice, $module = $opal.module, $klass = $opal.klass;

  $opal.add_stubs(['$include', '$attr_reader', '$to_n', '$[]', '$new']);
  return (function($base) {
    var self = $module($base, 'Browser');

    var def = self._proto, $scope = self._scope;

    (function($base, $super) {
      function $Canvas(){};
      var self = $Canvas = $klass($base, $super, 'Canvas', $Canvas);

      var def = self._proto, $scope = self._scope;

      (function($base, $super) {
        function $StyleObject(){};
        var self = $StyleObject = $klass($base, $super, 'StyleObject', $StyleObject);

        var def = self._proto, $scope = self._scope, TMP_1;

        def.context = nil;
        self.$include($scope.Native);

        self.$attr_reader("context");

        return (def.$initialize = TMP_1 = function(context) {
          var self = this, $iter = TMP_1._p, $yield = $iter || nil;

          TMP_1._p = null;
          self.context = context;
          return $opal.find_super_dispatcher(self, 'initialize', TMP_1, null).apply(self, [self.context.$to_n()]);
        }, nil) && 'initialize';
      })(self, null);

      return (function($base, $super) {
        function $Style(){};
        var self = $Style = $klass($base, $super, 'Style', $Style);

        var def = self._proto, $scope = self._scope, TMP_2;

        def["native"] = nil;
        (function($base, $super) {
          function $Line(){};
          var self = $Line = $klass($base, $super, 'Line', $Line);

          var def = self._proto, $scope = self._scope;

          def["native"] = nil;
          self.$attr_reader("width", "cap", "join", "miter_limit");

          def['$width='] = function(value) {
            var self = this;

            return self["native"].lineWidth = self.width = value;
          };

          def['$cap='] = function(value) {
            var self = this;

            return self["native"].lineCap = self.cap = value;
          };

          def['$join='] = function(value) {
            var self = this;

            return self["native"].lineJoin = self.join = value;
          };

          return (def['$miter_limit='] = function(value) {
            var self = this;

            return self["native"].miterLimit = self.miter_limit = value;
          }, nil) && 'miter_limit=';
        })(self, $scope.StyleObject);

        (function($base, $super) {
          function $Text(){};
          var self = $Text = $klass($base, $super, 'Text', $Text);

          var def = self._proto, $scope = self._scope;

          def["native"] = nil;
          self.$attr_reader("font", "align", "baseline");

          def['$font='] = function(value) {
            var self = this;

            return self["native"].font = self.font = value;
          };

          def['$align='] = function(value) {
            var self = this;

            return self["native"].textAlign = self.align = value;
          };

          return (def['$baseline='] = function(value) {
            var self = this;

            return self["native"].textBaseline = self.baseline = value;
          }, nil) && 'baseline=';
        })(self, $scope.StyleObject);

        (function($base, $super) {
          function $Image(){};
          var self = $Image = $klass($base, $super, 'Image', $Image);

          var def = self._proto, $scope = self._scope;

          def["native"] = nil;
          self.$attr_reader("smooth");

          $opal.defn(self, '$smooth?', def.$smooth);

          def['$smooth!'] = function() {
            var self = this;

            return self["native"].mozImageSmoothingEnabled = self.smooth = true;
          };

          return (def['$no_smooth!'] = function() {
            var self = this;

            return self["native"].mozImageSmoothingEnabled = self.smooth = false;
          }, nil) && 'no_smooth!';
        })(self, $scope.StyleObject);

        (function($base, $super) {
          function $Shadow(){};
          var self = $Shadow = $klass($base, $super, 'Shadow', $Shadow);

          var def = self._proto, $scope = self._scope;

          def["native"] = nil;
          self.$attr_reader("offset", "blur", "color");

          def['$offset='] = function(value) {
            var self = this;

            self["native"].shadowOffsetX = value['$[]']("x");
            self["native"].shadowOffsetY = value['$[]']("y");
            return self.offset = value;
          };

          def['$blur='] = function(value) {
            var self = this;

            return self["native"].shadowBlur = self.blur = value;
          };

          return (def['$color='] = function(value) {
            var self = this;

            return self["native"].shadowColor = self.color = value;
          }, nil) && 'color=';
        })(self, $scope.StyleObject);

        self.$attr_reader("line", "text", "image", "shadow", "fill", "stroke", "alpha", "composite_operation");

        def.$initialize = TMP_2 = function(context) {
          var self = this, $iter = TMP_2._p, $yield = $iter || nil;

          TMP_2._p = null;
          $opal.find_super_dispatcher(self, 'initialize', TMP_2, null).apply(self, [context]);
          self.line = $scope.Line.$new(context);
          self.text = $scope.Text.$new(context);
          self.image = $scope.Image.$new(context);
          return self.shadow = $scope.Shadow.$new(context);
        };

        def['$fill='] = function(value) {
          var self = this;

          return self["native"].fillStyle = (self.fill = value).$to_n();
        };

        def['$stroke='] = function(value) {
          var self = this;

          return self["native"].strokeStyle = (self.stroke = value).$to_n();
        };

        def['$alpha='] = function(value) {
          var self = this;

          return self["native"].globalAlpha = self.alpha = value;
        };

        return (def['$composite_operation='] = function(value) {
          var self = this;

          return self["native"].globalCompositeOperation = self.composite_operation = value;
        }, nil) && 'composite_operation=';
      })(self, $scope.StyleObject);
    })(self, null)
    
  })(self)
})(Opal);
/* Generated by Opal 0.6.2 */
(function($opal) {
  var self = $opal.top, $scope = $opal, nil = $opal.nil, $breaker = $opal.breaker, $slice = $opal.slice, $module = $opal.module, $klass = $opal.klass;

  $opal.add_stubs(['$include', '$attr_reader', '$to_n']);
  return (function($base) {
    var self = $module($base, 'Browser');

    var def = self._proto, $scope = self._scope;

    (function($base, $super) {
      function $Canvas(){};
      var self = $Canvas = $klass($base, $super, 'Canvas', $Canvas);

      var def = self._proto, $scope = self._scope;

      return (function($base, $super) {
        function $Text(){};
        var self = $Text = $klass($base, $super, 'Text', $Text);

        var def = self._proto, $scope = self._scope, TMP_1;

        def.context = def["native"] = nil;
        self.$include($scope.Native);

        self.$attr_reader("context");

        def.$initialize = TMP_1 = function(context) {
          var self = this, $iter = TMP_1._p, $yield = $iter || nil;

          TMP_1._p = null;
          self.context = context;
          return $opal.find_super_dispatcher(self, 'initialize', TMP_1, null).apply(self, [self.context.$to_n()]);
        };

        def.$measure = function(text) {
          var self = this;

          return self["native"].measureText(text);
        };

        def.$fill = function(text, x, y, max_width) {
          var $a, self = this;

          if (x == null) {
            x = nil
          }
          if (y == null) {
            y = nil
          }
          if (max_width == null) {
            max_width = nil
          }
          ((($a = x) !== false && $a !== nil) ? $a : x = 0);
          ((($a = y) !== false && $a !== nil) ? $a : y = 0);
          if (max_width !== false && max_width !== nil) {
            self["native"].fillText(text, x, y, max_width);
            } else {
            self["native"].fillText(text, x, y);
          };
          return self.context;
        };

        return (def.$stroke = function(text, x, y, max_width) {
          var $a, self = this;

          if (x == null) {
            x = nil
          }
          if (y == null) {
            y = nil
          }
          if (max_width == null) {
            max_width = nil
          }
          ((($a = x) !== false && $a !== nil) ? $a : x = 0);
          ((($a = y) !== false && $a !== nil) ? $a : y = 0);
          if (max_width !== false && max_width !== nil) {
            self["native"].strokeText(text, x, y, max_width);
            } else {
            self["native"].strokeText(text, x, y);
          };
          return self.context;
        }, nil) && 'stroke';
      })(self, null)
    })(self, null)
    
  })(self)
})(Opal);
/* Generated by Opal 0.6.2 */
(function($opal) {
  var self = $opal.top, $scope = $opal, nil = $opal.nil, $breaker = $opal.breaker, $slice = $opal.slice, $module = $opal.module, $klass = $opal.klass;

  $opal.add_stubs(['$allocate', '$instance_eval', '$to_a', '$to_n', '$include', '$attr_reader']);
  return (function($base) {
    var self = $module($base, 'Browser');

    var def = self._proto, $scope = self._scope;

    (function($base, $super) {
      function $Canvas(){};
      var self = $Canvas = $klass($base, $super, 'Canvas', $Canvas);

      var def = self._proto, $scope = self._scope;

      return (function($base, $super) {
        function $Data(){};
        var self = $Data = $klass($base, $super, 'Data', $Data);

        var def = self._proto, $scope = self._scope, TMP_2;

        def.canvas = def["native"] = nil;
        $opal.defs(self, '$create', function(canvas, width, height) {
          var $a, $b, TMP_1, self = this, data = nil;

          data = self.$allocate();
          ($a = ($b = data).$instance_eval, $a._p = (TMP_1 = function(){var self = TMP_1._s || this;

          self.canvas = canvas.$to_a();
            self.x = 0;
            self.y = 0;
            self.width = width;
            self.height = height;
            return self["native"] = canvas.$to_n().createImageData(width, height);}, TMP_1._s = self, TMP_1), $a).call($b);
          return data;
        });

        self.$include($scope.Native);

        self.$attr_reader("x", "y", "width", "height");

        def.$initialize = TMP_2 = function(canvas, x, y, width, height) {
          var self = this, $iter = TMP_2._p, $yield = $iter || nil;

          TMP_2._p = null;
          self.canvas = canvas.$to_n();
          self.x = x;
          self.y = y;
          self.width = width;
          self.height = height;
          return $opal.find_super_dispatcher(self, 'initialize', TMP_2, null).apply(self, [self.canvas.getImageData(x, y, width, height)]);
        };

        def.$length = function() {
          var self = this;

          return self["native"].data.length;
        };

        def['$[]'] = function(index) {
          var self = this;

          return self["native"].data[index];
        };

        def['$[]='] = function(index, value) {
          var self = this;

          return self["native"].data[index] = value;
        };

        def.$save = function(x, y) {
          var $a, self = this;

          if (x == null) {
            x = nil
          }
          if (y == null) {
            y = nil
          }
          ((($a = x) !== false && $a !== nil) ? $a : x = 0);
          ((($a = y) !== false && $a !== nil) ? $a : y = 0);
          return self.canvas.putImageData(self["native"], x, y);
        };

        def.$save_to = function(canvas, x, y) {
          var $a, self = this;

          if (x == null) {
            x = nil
          }
          if (y == null) {
            y = nil
          }
          ((($a = x) !== false && $a !== nil) ? $a : x = 0);
          ((($a = y) !== false && $a !== nil) ? $a : y = 0);
          return canvas.$to_n().putImageData(self["native"], x, y);
        };

        return $opal.defn(self, '$size', def.$length);
      })(self, null)
    })(self, null)
    
  })(self)
})(Opal);
/* Generated by Opal 0.6.2 */
(function($opal) {
  var self = $opal.top, $scope = $opal, nil = $opal.nil, $breaker = $opal.breaker, $slice = $opal.slice, $module = $opal.module, $klass = $opal.klass;

  $opal.add_stubs(['$include', '$attr_reader', '$length', '$===', '$to_n', '$raise', '$instance_eval', '$to_proc']);
  return (function($base) {
    var self = $module($base, 'Browser');

    var def = self._proto, $scope = self._scope;

    (function($base, $super) {
      function $Canvas(){};
      var self = $Canvas = $klass($base, $super, 'Canvas', $Canvas);

      var def = self._proto, $scope = self._scope;

      return (function($base, $super) {
        function $Gradient(){};
        var self = $Gradient = $klass($base, $super, 'Gradient', $Gradient);

        var def = self._proto, $scope = self._scope, TMP_1;

        def.context = nil;
        self.$include($scope.Native);

        self.$attr_reader("context");

        def.$initialize = TMP_1 = function(context, args) {
          var $a, $b, self = this, $iter = TMP_1._p, block = $iter || nil, $case = nil;

          args = $slice.call(arguments, 1);
          TMP_1._p = null;
          self.context = context;
          $opal.find_super_dispatcher(self, 'initialize', TMP_1, null).apply(self, [(function() {$case = args.$length();if ((4)['$===']($case)) {return self.context.$to_n().createLinearGradient.apply(self, args);}else if ((6)['$===']($case)) {return self.context.$to_n().createRadialGradient.apply(self, args);}else {return self.$raise($scope.ArgumentError, "don't know where to dispatch")}})()]);
          return ($a = ($b = self).$instance_eval, $a._p = block.$to_proc(), $a).call($b);
        };

        return (def.$add = function(position, color) {
          var self = this;

          self.context.$to_n().addColorStop(position, color);
          return self;
        }, nil) && 'add';
      })(self, null)
    })(self, null)
    
  })(self)
})(Opal);
/* Generated by Opal 0.6.2 */
(function($opal) {
  var self = $opal.top, $scope = $opal, nil = $opal.nil, $breaker = $opal.breaker, $slice = $opal.slice, $module = $opal.module, $klass = $opal.klass, $gvars = $opal.gvars;

  $opal.add_stubs(['$include', '$attr_reader', '$===', '$first', '$shift', '$create_element', '$[]=', '$width', '$height', '$!', '$==', '$node_name', '$raise', '$to_n', '$new', '$draw_image', '$to_i', '$[]', '$append_to', '$on', '$resolve', '$DOM', '$to_proc', '$move_to', '$line_to', '$length', '$quadratic_curve_to', '$bezier_curve_to', '$element', '$is_a?', '$save', '$instance_eval', '$restore', '$path', '$for']);
  ;
  ;
  ;
  ;
  ;
  return (function($base) {
    var self = $module($base, 'Browser');

    var def = self._proto, $scope = self._scope, $a, $b, TMP_12;

    (function($base, $super) {
      function $Canvas(){};
      var self = $Canvas = $klass($base, $super, 'Canvas', $Canvas);

      var def = self._proto, $scope = self._scope, TMP_1, TMP_3, TMP_4, TMP_5, TMP_6, TMP_7, TMP_8, TMP_9, TMP_10, TMP_11;

      def.element = def.image = def["native"] = nil;
      self.$include($scope.Native);

      self.$attr_reader("element", "style", "text");

      def.$initialize = TMP_1 = function(args) {
        var $a, self = this, $iter = TMP_1._p, $yield = $iter || nil, element = nil;
        if ($gvars.document == null) $gvars.document = nil;

        args = $slice.call(arguments, 0);
        TMP_1._p = null;
        if ((($a = ($scope.DOM)._scope.Element['$==='](args.$first())) !== nil && (!$a._isBoolean || $a == true))) {
          element = args.$shift();
          if ((($a = (($scope.DOM)._scope.Element)._scope.Image['$==='](element)) !== nil && (!$a._isBoolean || $a == true))) {
            self.image = element
            } else {
            self.element = element
          };
        } else if ((($a = $scope.Canvas['$==='](args.$first())) !== nil && (!$a._isBoolean || $a == true))) {
          self.image = args.$first()};
        if ((($a = self.element) !== nil && (!$a._isBoolean || $a == true))) {
          } else {
          self.element = $gvars.document.$create_element("canvas");
          if ((($a = self.image) !== nil && (!$a._isBoolean || $a == true))) {
            self.element['$[]=']("width", self.image.$width());
            self.element['$[]=']("height", self.image.$height());
            } else {
            self.element['$[]=']("width", args.$shift());
            self.element['$[]=']("height", args.$shift());
          };
        };
        if ((($a = self.element.$node_name()['$==']("CANVAS")['$!']()) !== nil && (!$a._isBoolean || $a == true))) {
          self.$raise($scope.ArgumentError, "the element isn't a <canvas> element")};
        $opal.find_super_dispatcher(self, 'initialize', TMP_1, null).apply(self, [self.element.$to_n().getContext('2d')]);
        self.style = $scope.Style.$new(self);
        self.text = $scope.Text.$new(self);
        if ((($a = self.image) !== nil && (!$a._isBoolean || $a == true))) {
          return self.$draw_image(self.image)
          } else {
          return nil
        };
      };

      def.$width = function() {
        var self = this;

        return self.element['$[]']("width").$to_i();
      };

      def.$height = function() {
        var self = this;

        return self.element['$[]']("height").$to_i();
      };

      def.$append_to = function(parent) {
        var self = this;

        return self.element.$append_to(parent);
      };

      def.$load = function(path) {
        var $a, $b, TMP_2, self = this, promise = nil, image = nil;
        if ($gvars.document == null) $gvars.document = nil;

        promise = $scope.Promise.$new();
        image = $gvars.document.$create_element("img");
        ($a = ($b = image).$on, $a._p = (TMP_2 = function(){var self = TMP_2._s || this;

        return promise.$resolve(image)}, TMP_2._s = self, TMP_2), $a).call($b, "load");
        image['$[]=']("src", path);
        return promise;
      };

      def.$data = function(x, y, width, height) {
        var $a, self = this;

        if (x == null) {
          x = nil
        }
        if (y == null) {
          y = nil
        }
        if (width == null) {
          width = nil
        }
        if (height == null) {
          height = nil
        }
        ((($a = x) !== false && $a !== nil) ? $a : x = 0);
        ((($a = y) !== false && $a !== nil) ? $a : y = 0);
        ((($a = width) !== false && $a !== nil) ? $a : width = self.$width());
        ((($a = height) !== false && $a !== nil) ? $a : height = self.$height());
        return $scope.Data.$new(self, x, y, width, height);
      };

      def.$pattern = function(image, type) {
        var self = this;

        if (type == null) {
          type = "repeat"
        }
        return self["native"].createPattern(self.$DOM(image).$to_n(), type);
      };

      def.$gradient = TMP_3 = function(args) {
        var $a, $b, self = this, $iter = TMP_3._p, block = $iter || nil;

        args = $slice.call(arguments, 0);
        TMP_3._p = null;
        return ($a = ($b = $scope.Gradient).$new, $a._p = block.$to_proc(), $a).apply($b, [self].concat(args));
      };

      def.$clear = function(x, y, width, height) {
        var $a, self = this;

        if (x == null) {
          x = nil
        }
        if (y == null) {
          y = nil
        }
        if (width == null) {
          width = nil
        }
        if (height == null) {
          height = nil
        }
        ((($a = x) !== false && $a !== nil) ? $a : x = 0);
        ((($a = y) !== false && $a !== nil) ? $a : y = 0);
        ((($a = width) !== false && $a !== nil) ? $a : width = self.$width());
        ((($a = height) !== false && $a !== nil) ? $a : height = self.$height());
        return self["native"].clearRect(x, y, width, height);
      };

      def.$begin = function() {
        var self = this;

        self["native"].beginPath();
        return self;
      };

      def.$close = function() {
        var self = this;

        self["native"].closePath();
        return self;
      };

      def.$save = function() {
        var self = this;

        self["native"].save();
        return self;
      };

      def.$restore = function() {
        var self = this;

        self["native"].restore();
        return self;
      };

      def.$move_to = function(x, y) {
        var self = this;

        self["native"].moveTo(x, y);
        return self;
      };

      $opal.defn(self, '$move', def.$move_to);

      def.$line_to = function(x, y) {
        var self = this;

        self["native"].lineTo(x, y);
        return self;
      };

      def.$line = function(x1, y1, x2, y2) {
        var self = this;

        self.$move_to(x1, y1);
        return self.$line_to(x2, y2);
      };

      def.$rect = function(x, y, width, height) {
        var self = this;

        self["native"].rect(x, y, width, height);
        return self;
      };

      def.$arc = function(x, y, radius, angle, clockwise) {
        var self = this;

        if (clockwise == null) {
          clockwise = false
        }
        self["native"].arc(x, y, radius, angle['$[]']("start"), angle['$[]']("end"), !clockwise);
        return self;
      };

      def.$quadratic_curve_to = function(cp1x, cp1y, x, y) {
        var self = this;

        self["native"].quadraticCurveTo(cp1x, cp1y, x, y);
        return self;
      };

      def.$bezier_curve_to = function(cp1x, cp1y, cp2x, cp2y, x, y) {
        var self = this;

        self["native"].bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);
        return self;
      };

      def.$curve_to = function(args) {
        var $a, $b, self = this, $case = nil;

        args = $slice.call(arguments, 0);
        $case = args.$length();if ((4)['$===']($case)) {($a = self).$quadratic_curve_to.apply($a, [].concat(args))}else if ((6)['$===']($case)) {($b = self).$bezier_curve_to.apply($b, [].concat(args))}else {self.$raise($scope.ArgumentError, "don't know where to dispatch")};
        return self;
      };

      def.$draw_image = function(image, args) {
        var $a, self = this, source = nil, destination = nil, $case = nil;

        args = $slice.call(arguments, 1);
        if ((($a = $scope.Canvas['$==='](image)) !== nil && (!$a._isBoolean || $a == true))) {
          image = image.$element()
          } else {
          image = self.$DOM(image)
        };
        if ((($a = args.$first()['$is_a?']($scope.Hash)) !== nil && (!$a._isBoolean || $a == true))) {
          $a = $opal.to_ary(args), source = ($a[0] == null ? nil : $a[0]), destination = ($a[1] == null ? nil : $a[1]);
          self["native"].drawImage(image.$to_n(), source['$[]']("x"), source['$[]']("y"), source['$[]']("width"), source['$[]']("height"), destination['$[]']("x"), destination['$[]']("y"), destination['$[]']("width"), destination['$[]']("height"));
          } else {
          $case = args.$length();if ((0)['$===']($case)) {self["native"].drawImage(image.$to_n(), 0, 0);}else if ((2)['$===']($case)) {self["native"].drawImage(image.$to_n(), args['$[]'](0), args['$[]'](1));}else if ((4)['$===']($case)) {self["native"].drawImage(image.$to_n(), args['$[]'](0), args['$[]'](1), args['$[]'](2), args['$[]'](3));}
        };
        return self;
      };

      def.$translate = TMP_4 = function(x, y) {
        var $a, $b, self = this, $iter = TMP_4._p, block = $iter || nil;

        TMP_4._p = null;
        if (block !== false && block !== nil) {
          self.$save();
          self["native"].translate(x, y);
          ($a = ($b = self).$instance_eval, $a._p = block.$to_proc(), $a).call($b);
          self.$restore();
          } else {
          self["native"].translate(x, y);
        };
        return self;
      };

      def.$rotate = TMP_5 = function(angle) {
        var $a, $b, self = this, $iter = TMP_5._p, block = $iter || nil;

        TMP_5._p = null;
        if (block !== false && block !== nil) {
          self.$save();
          self["native"].rotate(angle);
          ($a = ($b = self).$instance_eval, $a._p = block.$to_proc(), $a).call($b);
          self.$restore();
          } else {
          self["native"].rotate(angle);
        };
        return self;
      };

      def.$scale = TMP_6 = function(x, y) {
        var $a, $b, self = this, $iter = TMP_6._p, block = $iter || nil;

        TMP_6._p = null;
        if (block !== false && block !== nil) {
          self.$save();
          self["native"].scale(x, y);
          ($a = ($b = self).$instance_eval, $a._p = block.$to_proc(), $a).call($b);
          self.$restore();
          } else {
          self["native"].scale(x, y);
        };
        return self;
      };

      def.$transform = TMP_7 = function(m11, m12, m21, m22, dx, dy) {
        var $a, $b, self = this, $iter = TMP_7._p, block = $iter || nil;

        TMP_7._p = null;
        if (block !== false && block !== nil) {
          self.$save();
          self["native"].transform(m11, m12, m21, m22, dx, dy);
          ($a = ($b = self).$instance_eval, $a._p = block.$to_proc(), $a).call($b);
          self.$restore();
          } else {
          self["native"].transform(m11, m12, m21, m22, dx, dy);
        };
        return self;
      };

      def.$path = TMP_8 = function() {
        var $a, $b, self = this, $iter = TMP_8._p, block = $iter || nil;

        TMP_8._p = null;
        self["native"].beginPath();
        ($a = ($b = self).$instance_eval, $a._p = block.$to_proc(), $a).call($b);
        self["native"].closePath();
        return self;
      };

      def.$fill = TMP_9 = function() {
        var $a, $b, self = this, $iter = TMP_9._p, block = $iter || nil;

        TMP_9._p = null;
        if (block !== false && block !== nil) {
          ($a = ($b = self).$path, $a._p = block.$to_proc(), $a).call($b)};
        self["native"].fill();
        return self;
      };

      def.$stroke = TMP_10 = function() {
        var $a, $b, self = this, $iter = TMP_10._p, block = $iter || nil;

        TMP_10._p = null;
        if (block !== false && block !== nil) {
          ($a = ($b = self).$path, $a._p = block.$to_proc(), $a).call($b)};
        self["native"].stroke();
        return self;
      };

      def.$clip = TMP_11 = function() {
        var $a, $b, self = this, $iter = TMP_11._p, block = $iter || nil;

        TMP_11._p = null;
        if (block !== false && block !== nil) {
          ($a = ($b = self).$path, $a._p = block.$to_proc(), $a).call($b)};
        self["native"].clip();
        return self;
      };

      def['$point_in_path?'] = function(x, y) {
        var self = this;

        return self["native"].isPointInPath(x, y);
      };

      return (def.$to_data = function(type) {
        var self = this;

        return self.element.$to_n().toDataUrl(type);
      }, nil) && 'to_data';
    })(self, null);

    ($a = ($b = (($scope.Browser)._scope.DOM)._scope.Builder).$for, $a._p = (TMP_12 = function(b, item){var self = TMP_12._s || this;
if (b == null) b = nil;if (item == null) item = nil;
    return item.$element()}, TMP_12._s = self, TMP_12), $a).call($b, $scope.Canvas);
    
  })(self);
})(Opal);
